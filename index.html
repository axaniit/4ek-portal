<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>4EK Ambassador Portal</title>

  <meta name="robots" content="noindex, nofollow">

  <!-- Fonts: keep Nunito for body, add a sharper headline font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">

  <!-- Theme CSS (no leading slash for GitHub Pages project sites) -->
  <link rel="stylesheet" href="assets/portal-theme.css?v=2">

  <style>
    :root{ --brand-gold:#c8a700; }

    body{ margin:0; }

    /* Remove the entire top bar section (UCF Alumni header) */
    .ucf-topbar{ display:none !important; }

    /* Hero bar (gold) */
    .portal-hero{
      background: var(--brand-gold) !important;
      text-align:center !important;
      padding: 32px 16px !important;
    }
    .portal-hero h1{
      font-family: "Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
      font-weight: 800 !important;
      font-size: 43px !important; /* +3px from your prior 40px */
      letter-spacing: .2px;
      margin: 0 !important;
      text-align:center !important;
      color:#111 !important;
    }
    .portal-accent-line{ display:none !important; }

    /* Center area under hero like the old page */
    .login-wrap{ max-width: 980px; margin: 0 auto; padding: 22px 16px 48px; }
    #box{ margin: 18px auto 0 !important; }

    /* Login box typography */
    #box h2{
      font-family: "Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
      font-weight: 800 !important;
      font-size: 27px !important; /* +3px from your prior ~24px default-ish */
      letter-spacing: .2px;
    }

    /* Form bits */
    .field{display:block;margin:10px 0 12px;}
    .input{width:100%;padding:10px 12px;border:1px solid #cfcfcf;border-radius:8px;margin-top:6px;box-sizing:border-box;}
    .hint{font-size:12px;color:#666;margin-top:6px;line-height:1.35}
    .hidden{display:none}
    a{color:#111}

    /* Button: gold background, thinner "Continue" */
    .btn{
      width:100%;
      padding:12px;
      border:0;
      border-radius:8px;
      background: var(--brand-gold) !important;
      color:#111 !important;
      cursor:pointer;
      font-family:"Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
      font-weight: 400 !important; /* thinner */
      letter-spacing:.25px;
      text-transform:uppercase;
      box-shadow: 0 3px 0 rgba(0,0,0,.18);
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
  </style>
</head>

<body>
  <!-- Gold hero only (top bar removed) -->
  <section class="portal-hero">
    <h1>4EK Ambassador Portal</h1>
  </section>

  <main class="login-wrap">
    <div id="box" style="max-width:460px;margin:24px auto;padding:18px;border:1px solid #e2e2e2;border-radius:12px;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.06)">
      <h2 style="margin:0 0 6px;">4EK Ambassador Portal</h2>
      <p style="color:#666;margin:0 0 14px;">Login with UCF Email</p>

      <div id="msg" class="hint hidden" style="margin-bottom:12px;"></div>

      <form id="stepLogin">
        <label class="field">UCF Email
          <input id="email" type="email" class="input" placeholder="you@ucf.edu" required autocomplete="username">
        </label>
        <label class="field">Password
          <input id="password" type="password" class="input" autocomplete="current-password">
        </label>
        <button class="btn" id="btnLogin" type="submit">Continue</button>
      </form>
    </div>
  </main>

  <script>
  /* ===== CONFIG ===== */
  const API = "https://script.google.com/macros/s/AKfycbxUUnLnZWfYGe0ZJ5NKtoLXa78qXCK-cEeCv2Ip_3Xm_XUDy-fFp-w0gShBxakcjJdCPg/exec";
  const SESSION_KEY = "portal_session_v1";

  /* ===== UTIL ===== */
  const $ = (id) => document.getElementById(id);

  function setMsg(t, ok=false){
    const el = $("msg");
    el.classList.remove("hidden");
    el.style.color = ok ? "#1a7f37" : "#b00020";
    el.textContent = t;
  }
  function hideMsg(){ $("msg").classList.add("hidden"); $("msg").textContent=""; }

  function saveSession(username, role){
    const payload = { username, role, ts: Date.now() };
    localStorage.setItem(SESSION_KEY, JSON.stringify(payload));
  }

  function getBase(){
    const { origin, pathname } = window.location;
    const dir = pathname.replace(/\/[^\/]*$/, "");
    return origin + (dir === "" ? "" : dir);
  }

  function redirectToPortal(role){
    const base = getBase();
    const target = role === "admin"
      ? base + "/admin.html"
      : base + "/student.html";

    console.log("Redirecting to:", target);
    window.location.href = target;
  }

  /* ===== API ===== */
  async function POST_LOGIN(email, password){
    const qs = new URLSearchParams({
      action: "login",
      student_id: email,
      email: email,
      username: email
    }).toString();

    const url = API + "?" + qs;

    const r = await fetch(url, {
      method: "POST",
      mode: "cors",
      cache: "no-cache",
      body: JSON.stringify({
        student_id: email,
        email: email,
        username: email,
        password: password
      })
    });

    const t = await r.text();
    try { return JSON.parse(t); }
    catch { return { ok:false, error:"Invalid JSON", body:t }; }
  }

  /* ===== LOGIN ===== */
  $("stepLogin").addEventListener("submit", async (e)=>{
    e.preventDefault();
    hideMsg();

    const email = ($("email").value || "").trim().toLowerCase();
    const password = $("password").value || "";

    if(!email){ setMsg("Enter your UCF email."); return; }
    if(!password){ setMsg("Enter your password."); return; }

    $("btnLogin").disabled = true;
    $("btnLogin").textContent = "Loadingâ€¦";

    try{
      localStorage.removeItem(SESSION_KEY);

      const out = await POST_LOGIN(email, password);
      console.log("LOGIN response:", out);

      if(out?.ok && out.role){
        saveSession(email, out.role);
        redirectToPortal(out.role);
        return;
      }

      if(out?.status === "bad_password"){
        setMsg("Incorrect password.");
      } else if(out?.error){
        setMsg("Login failed: " + out.error);
      } else {
        setMsg("Login failed.");
      }

    }catch(err){
      console.error("Login error:", err);
      setMsg("Could not reach login service.");
    }

    $("btnLogin").disabled = false;
    $("btnLogin").textContent = "Continue";
  });
  </script>
</body>
</html>
