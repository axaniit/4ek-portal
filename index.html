<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>4EK Ambassador Portal</title>
  <meta name="robots" content="noindex, nofollow">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">

  <!-- Theme -->
  <link rel="stylesheet" href="assets/portal-theme.css?v=4">

 <style>
  body{
    margin:0;
    font-family:"Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  /* ========= HERO (FORCED) ========= */

  section.portal-hero{
    background:#F4CA3D !important;        /* HARD color */
    background-image:none !important;     /* kill gradients */
    min-height:100px !important;          /* thicker hero */
    display:flex !important;
    align-items:center !important;
    justify-content:center !important;
    text-align:center !important;
    padding:0 !important;                 /* remove theme padding */
  }

  section.portal-hero h1{
    font-family:"Montserrat", sans-serif !important;
    font-size:44px !important;            /* slightly larger */
    font-weight:700 !important;
    margin:0 !important;
    color:#111 !important;
  }

  /* Accent line under hero */
  .portal-accent-line{
    height:6px !important;                /* thicker line */
    background:#F4CA3D !important;
  }

  /* Second title inside box */
  #box h2{
    font-family:"Montserrat", sans-serif !important;
    font-size:28px !important;
    font-weight:700 !important;
    margin:0 0 6px !important;
    color:#111 !important;
  }

  /* ========= LOGIN FORM ========= */

  .login-wrap{
    max-width:980px;
    margin:0 auto;
    padding:22px 16px 48px;
  }

  #box{
    margin:24px auto 0 !important;
  }

  .field{
    display:block;
    margin:10px 0 12px;
    font-weight:600;
  }

  .input{
    width:100%;
    padding:10px 12px;
    border:1px solid #cfcfcf;
    border-radius:8px;
    margin-top:6px;
    box-sizing:border-box;
    font-family:"Nunito", sans-serif;
  }

  /* Continue Button */
  #btnLogin{
    width:100%;
    padding:14px;                         /* slightly taller */
    border:0;
    border-radius:8px;
    background:#F4CA3D !important;         /* HARD yellow */
    background-image:none !important;
    color:#111 !important;
    cursor:pointer;
    font-weight:600 !important;            /* medium, not thin */
    letter-spacing:.3px;
    text-transform:uppercase;
    box-shadow:0 3px 0 rgba(0,0,0,.18);
  }

  #btnLogin:disabled{
    opacity:.6;
    cursor:not-allowed;
  }

  .hint{
    font-size:12px;
    color:#666;
    margin-top:6px;
    line-height:1.35;
  }

  .hidden{display:none;}
</style>

</head>

<body>

  <!-- HERO -->
  <section class="portal-hero">
    <h1>4EK Ambassador Portal</h1>
  </section>
  <div class="portal-accent-line"></div>

  <main class="login-wrap">
    <div id="box" style="max-width:460px;margin:24px auto;padding:18px;border:1px solid #e2e2e2;border-radius:12px;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.06)">
      <h2>4EK Ambassador Portal</h2>
      <p style="color:#666;margin:0 0 14px;">Login with UCF Email</p>

      <div id="msg" class="hint hidden" style="margin-bottom:12px;"></div>

      <form id="stepLogin">
        <label class="field">UCF Email
          <input id="email" type="email" class="input" placeholder="you@ucf.edu" required autocomplete="username">
        </label>
        <label class="field">Password
          <input id="password" type="password" class="input" autocomplete="current-password">
        </label>
        <button id="btnLogin" type="submit">Continue</button>
      </form>
    </div>
  </main>

  <script>
  const API = "https://script.google.com/macros/s/AKfycbxUUnLnZWfYGe0ZJ5NKtoLXa78qXCK-cEeCv2Ip_3Xm_XUDy-fFp-w0gShBxakcjJdCPg/exec";
  const SESSION_KEY = "portal_session_v1";

  const $ = (id) => document.getElementById(id);

  function setMsg(t, ok=false){
    const el = $("msg");
    el.classList.remove("hidden");
    el.style.color = ok ? "#1a7f37" : "#b00020";
    el.textContent = t;
  }

  function saveSession(username, role){
    localStorage.setItem(SESSION_KEY, JSON.stringify({ username, role, ts: Date.now() }));
  }

  function getBase(){
    const { origin, pathname } = window.location;
    const dir = pathname.replace(/\/[^\/]*$/, "");
    return origin + (dir === "" ? "" : dir);
  }

  function redirectToPortal(role){
    const base = getBase();
    window.location.href = role === "admin"
      ? base + "/admin.html"
      : base + "/student.html";
  }

  async function POST_LOGIN(email, password){
    const qs = new URLSearchParams({
      action: "login",
      student_id: email,
      email: email,
      username: email
    }).toString();

    const r = await fetch(API + "?" + qs, {
      method: "POST",
      mode: "cors",
      cache: "no-cache",
      body: JSON.stringify({ student_id: email, email, username: email, password })
    });

    const t = await r.text();
    try { return JSON.parse(t); }
    catch { return { ok:false }; }
  }

  $("stepLogin").addEventListener("submit", async (e)=>{
    e.preventDefault();

    const email = ($("email").value || "").trim().toLowerCase();
    const password = $("password").value || "";

    if(!email){ setMsg("Enter your UCF email."); return; }
    if(!password){ setMsg("Enter your password."); return; }

    $("btnLogin").disabled = true;
    $("btnLogin").textContent = "Loadingâ€¦";

    try{
      localStorage.removeItem(SESSION_KEY);
      const out = await POST_LOGIN(email, password);

      if(out?.ok && out.role){
        saveSession(email, out.role);
        redirectToPortal(out.role);
        return;
      }

      setMsg("Login failed.");
    }catch{
      setMsg("Could not reach login service.");
    }

    $("btnLogin").disabled = false;
    $("btnLogin").textContent = "Continue";
  });
  </script>

</body>
</html>
